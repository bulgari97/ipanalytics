# IPAnalytics

**IPAnalytics** – это библиотека для логирования посещений и управления банами IP и User-Agent через Redis. Позволяет легко интегрировать логирование и контроль доступа в ваши приложения. Включает клиент с удобной аналитикой.

## Установка

```sh
npm install ipanalytics
```

## Использование

### Импорт и инициализация

```ts
import IPLogger from "ipanalytics";

const logger = new IPLogger({
  host: "localhost", // Используется для Redis (по умолчанию localhost)
  port: 6379 // Используется для Redis (по умолчанию 6379)
}, {
  bannedPage: "<h1>Access Denied</h1>", // HTML-страница при бане
  ttlLOG: 86400, // Время хранения логов (в секундах)
  ttlBAN: 604800, // Время хранения бана (в секундах)
  port: 7649 // Порт локального клиента с аналитикой
});
```

### Логирование посещений

```ts
app.use(async (req, res, next) => {
  await logger.logVisit(req, res);
  next();
});
```


## Конфигурация

| Параметр      | Тип    | Описание                                                 |
|--------------|--------|----------------------------------------------------------|
| `host`       | string | Адрес сервера Redis (по умолчанию `localhost`)           |
| `port`       | number | Порт Redis (по умолчанию `6379`)                         |
| `bannedPage` | string | HTML-страница, отображаемая при бане                     |
| `ttlLOG`     | number | Время хранения логов в секундах                          |
| `ttlBAN`     | number | Время хранения бана в секундах                           |
| `port`       | number | Порт локального клиента с аналитикой (по умолчанию 7649) |

## Функции клиента

- Отображает посещения, отсортированные по IP или User-Agent.
- Фильтрация по времени захода, частоте посещений и статусу бана.
- Клиент доступен только с локального хоста.
- Для хранения данных используется Redis.

В случае бана IP или User-Agent пользователю будет показана подготовленная страница.

![Access Denied](./image.png)

## Запуск тестов

```sh
npm test
```

## Лицензия

MIT

